<!DOCTYPE html>
<html>
  <!-- This example HTML file is loaded by the Sample Addon to show simple SR creation. -->
  <head>
    <script src="https://s3-us-west-2.amazonaws.com/dc-sampleaddon-ui/gwsdk-1.0.9.js"></script>
    <style>
    body {font-family: Arial, Helvetica, sans-serif;}
    </style>
  </head>
  <body>
    <h3>Request Inspection Photos</h3>
    Inspection intake form w/ applicable fields prepoplulate (and hidden).<br/><br/>Customize message, lists, etc.<br/><br/>
    <button onclick="createSr()">Start Inspection</button>
    <button onclick="createPrefill()">Prefill 2.0</button>
    <button onclick="createPrefill2()">Prefill2 2.0</button>
    <br/><br/><div id="console"></div>
  </body>
  <script>
    function createSr() {
      var gwClient = GW.createClient("truepic", "tpvision");
      gwClient.getClient().then(function(client) {
        return Promise.all([client, client.getContext()]);
      }).then(function(values) {
        //This is where you would use the Context to prefill and eventually create a service on your side
        //We will just create a dummy SR
        var serviceRequest = {
          "referenceNumber": Math.floor(Math.random() * 10000),
          "serviceableId": values[1].candidates[0].id,
          "referenceId1": Math.floor(Math.random() * 10000)
        }
        console.log("My Values",JSON.stringify(values));

        return Promise.all([values[0], values[0].invokeWithoutRefresh("createService", serviceRequest)])
      }).then(function(values) {
        values[0].completed(values[1].referenceNumber);
      });
    }

    function createPrefill() {
      console.log("prefill");

      var gwClient = GW.createClient("truepic", "tpvision");
      gwClient.getClient().then(function(client) {
        return Promise.all([client, client.getContext()]);
      }).then(function(values) {
        console.log(values);
        //return values[0].httpRequest("GET", "/prefill/serviceable/" + values[1].candidates[0].id);
        return values[0].httpRequest("GET", "/helloworld/" + values[1].candidates[0].id);
        //return values[0].httpRequest("GET", "https://cors-anywhere.herokuapp.com/https://truepic-tpvision-test.sandbox.devconnect.io/cc/devconnect/truepic/tpvision/prefill/serviceable/" + values[1].candidates[0].id);

      }).then(function(response) {
        console.log("prefill", response);
        return response.json();
        //Use response to prefill fields.
      }).then(function(resp) {
        console.log(resp);
      });
    }

    function createPrefill2() {
      console.log("prefill2");

      var gwClient = GW.createClient("truepic", "tpvision");
      gwClient.getClient().then(function(client) {
        return Promise.all([client, client.getContext()]);
      }).then(function(values) {
        console.log(values);
        return values[0].httpRequest("GET", "/prefill/serviceable/" + values[1].candidates[0].id);

      }).then(function(response) {
        console.log("prefill2", response);
        return response.json();
        //Use response to prefill fields.
      }).then(function(resp) {
        console.log(resp);
      });
    }


    var gwClient = GW.createClient("truepic", "tpvision");
    gwClient.getClient().then(function(client) {
      return Promise.all([client, client.getContext()]);
    }).then(function(values) {
      document.getElementById("console").innerHTML = JSON.stringify(values);
    })
  </script>
</html>
