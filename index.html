<!DOCTYPE html>
<html>
  <!-- This example HTML file is loaded by the Sample Addon to show simple SR creation. -->
  <head>
    <script src="https://s3-us-west-2.amazonaws.com/dc-sampleaddon-ui/gwsdk-1.0.9.js"></script>
    <style>
    body {font-family: Arial, Helvetica, sans-serif;}
    </style>
  </head>
  <body>
    <h3>Request Inspection Photos</h3>
    <h4>Select Serviceable</h4>
    <select id="serviceableId" onchange="return selectServicable(this.value)">
      <option value=""></option>
    </select>
    <br/>
    <div style="display:none;" id="intake-form">
      Inspection intake form w/ applicable fields prepoplulate (and hidden).<br/><br/>Customize message, lists, etc.<br/><br/>
      First Name:<br/>
      <input type="text" id="firstname" value="" /><br/><br/>
      Last Name:<br/>
      <input type="text" id="lastname" value="" /><br/><br/>
      Phone Number:<br/>
      <input type="text" id="phone" value="" /><br/><br/>
      Address:<br/>
      <input type="text" id="address" value="" /><br/><br/>

      <button onclick="createSr()">Start Inspection</button>
      <button onclick="createPrefill()">Prefill 2.0</button>
      <button onclick="createPrefill2()">Prefill2 2.0</button>
    </div>

    <br/><br/>

    <div id="console"></div>
  </body>
  <script>
    function selectServicable(serviceableId) {
      var gwClient = GW.createClient("truepic", "tpvision");
      gwClient.getClient().then(function(client) {
        return Promise.all([client, client.getContext()]);
      }).then(function(values) {
        console.log(values);
        return values[0].httpRequest("GET", "/prefill/serviceable/" + values[1].candidates[0].id);

      }).then(function(response) {
        console.log("prefill2", response);
        document.getElementById("firstname").value = response.contactName;
        document.getElementById("lastname").value = response.contactName;
        document.getElementById("phone").value = response.contactPhone;

        document.getElementById('intake-form').style.display = 'block';

        return response.json();
        //Use response to prefill fields.
      }).then(function(resp) {
        //console.log(resp);
      });
    }

    var gwClient = GW.createClient("truepic", "tpvision");
    gwClient.getClient().then(function(client) {
      return Promise.all([client, client.getContext()]);
    }).then(function(values) {
      document.getElementById("console").innerHTML = JSON.stringify(values);

      candidates = values[1].candidates;

      populateServiceables(candidates);
    })

    function populateServiceables(serviceables) {
      var x = document.getElementById("serviceableId");

      for (var i = 0; i < serviceables.length; i++) {
        serviceable = serviceables[i];
        var option = document.createElement("option");
        option.value = serviceable.id;
        option.text = serviceable.type + " - " + serviceable.displayableName;
        x.add(option);
      }
    }
  </script>
</html>
